<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Mixing Analyzer</title>
    <link rel="stylesheet" href="index.css" />
    <script type="importmap">
{
  "imports": {
    "@google/genai": "https://esm.sh/@google/genai@^0.7.0",
    "marked": "https://esm.sh/marked@^15.0.7",
    "dompurify": "https://esm.sh/dompurify@^3.0.6",
    "jspdf": "https://esm.sh/jspdf@^2.5.1",
    "html2canvas": "https://esm.sh/html2canvas@^1.4.1",
    "./ui-elements": "./ui-elements.ts",
    "./gemini": "./gemini.ts",
    "./i18n": "./i18n.ts",
    "./ui": "./ui.ts",
    "./utils": "./utils.ts",
    "./visualizer": "./visualizer.ts"
  }
}
</script>
  </head>
  <body>
    <main class="app-layout">
        <header>
            <div class="top-bar">
                <div class="header-content">
                    <h1>Mixing Analyzer</h1>
                    <span class="subtitle">developed by stancsz</span>
                    <p data-i18n-key="appDescription">An AI-powered mixing analyzer for audio engineers, producers, and music professionals.</p>
                </div>
                <div class="control-group">
                    <label for="language-selector" data-i18n-key="languageLabel">Language</label>
                    <select id="language-selector">
                        <option value="en" selected>English</option>
                        <option value="zh">中文 (简体)</option>
                        <option value="zh-TW">中文 (繁體)</option>
                        <option value="ja">日本語</option>
                        <option value="ko">한국어</option>
                    </select>
                </div>
            </div>
        </header>

        <section class="input-panel">
            <div class="upload-container">
              <label for="file-upload" class="custom-file-upload">
                <span data-i18n-key="uploadLabel">&#127925; Choose Track or Stems</span>
              </label>
              <input id="file-upload" type="file" accept="audio/wav,audio/flac,audio/mpeg,.flac" multiple/>
              <span id="file-name" data-i18n-key="noFileSelected">No file(s) selected</span>
            </div>
            
            <div id="visualizer-panel" class="visualizer-panel" hidden>
                <h3 class="visualizer-title" data-i18n-key="realTimeAnalysisTitle">Real-time Analysis</h3>
                <div class="visualizer-controls">
                    <button id="play-pause-button" aria-label="Play/Pause"></button>
                    <div id="timeline-container">
                        <div id="progress-bar"></div>
                    </div>
                </div>
                <div class="canvas-grid">
                    <div class="canvas-container">
                        <label for="spectrogram-canvas" data-i18n-key="spectrogramLabel">Spectrogram</label>
                        <canvas id="spectrogram-canvas"></canvas>
                    </div>
                </div>
                 <div class="eq-section">
                    <div class="canvas-container eq-curve-container">
                        <label for="eq-curve-canvas" data-i18n-key="eqCurveLabel">EQ Curve</label>
                        <canvas id="eq-curve-canvas"></canvas>
                    </div>
                    <div class="eq-controls-container">
                        <div class="eq-header">
                            <h4 class="visualizer-subtitle" data-i18n-key="eqControlsTitle">3-Band Equalizer</h4>
                            <div class="header-buttons">
                                <button id="eq-reset-button" class="reset-button" data-i18n-key="resetButton">Reset</button>
                                <button id="download-processed-button" data-i18n-key="downloadProcessedButton" disabled>Download Processed</button>
                            </div>
                        </div>
                        <div class="eq-controls">
                            <!-- Low Band -->
                            <div class="eq-band">
                                <h5 data-i18n-key="eqLowLabel">Low Band</h5>
                                <div class="eq-slider">
                                    <label for="low-filter-type" data-i18n-key="eqTypeLabel">Type</label>
                                    <select id="low-filter-type">
                                        <option value="peaking" selected>Bell (Peaking)</option>
                                        <option value="lowshelf">Low Shelf</option>
                                        <option value="highshelf">High Shelf</option>
                                        <option value="lowpass">Low Pass</option>
                                        <option value="highpass">High Pass</option>
                                        <option value="bandpass">Bandpass</option>
                                        <option value="notch">Notch</option>
                                    </select>
                                </div>
                                <div class="eq-slider">
                                    <label for="low-gain" data-i18n-key="eqGainLabel">Gain</label>
                                    <input type="range" id="low-gain" class="eq-gain-slider" min="-12" max="12" value="0" step="1">
                                    <span id="low-gain-value" class="gain-value">0 dB</span>
                                </div>
                                <div class="eq-slider">
                                    <label for="low-freq" data-i18n-key="eqFreqLabel">Frequency</label>
                                    <input type="range" id="low-freq" min="30" max="400" value="100" step="1">
                                    <span id="low-freq-value" class="gain-value">100 Hz</span>
                                </div>
                                <div class="eq-slider" id="low-q-container">
                                    <label for="low-q" data-i18n-key="eqQLabel">Q Factor</label>
                                    <input type="range" id="low-q" min="0.1" max="10" value="1" step="0.1">
                                    <span id="low-q-value" class="gain-value">1.0</span>
                                </div>
                            </div>
                            <!-- Mid Band -->
                            <div class="eq-band">
                                <h5 data-i18n-key="eqMidLabel">Mid Band</h5>
                                <div class="eq-slider">
                                    <label for="mid-filter-type" data-i18n-key="eqTypeLabel">Type</label>
                                    <select id="mid-filter-type">
                                        <option value="peaking" selected>Bell (Peaking)</option>
                                        <option value="lowshelf">Low Shelf</option>
                                        <option value="highshelf">High Shelf</option>
                                        <option value="lowpass">Low Pass</option>
                                        <option value="highpass">High Pass</option>
                                        <option value="bandpass">Bandpass</option>
                                        <option value="notch">Notch</option>
                                    </select>
                                </div>
                                <div class="eq-slider">
                                    <label for="mid-gain" data-i18n-key="eqGainLabel">Gain</label>
                                    <input type="range" id="mid-gain" class="eq-gain-slider" min="-12" max="12" value="0" step="1">
                                    <span id="mid-gain-value" class="gain-value">0 dB</span>
                                </div>
                                <div class="eq-slider">
                                    <label for="mid-freq" data-i18n-key="eqFreqLabel">Frequency</label>
                                    <input type="range" id="mid-freq" min="200" max="5000" value="1000" step="10">
                                    <span id="mid-freq-value" class="gain-value">1.0 kHz</span>
                                </div>
                                <div class="eq-slider" id="mid-q-container">
                                    <label for="mid-q" data-i18n-key="eqQLabel">Q Factor</label>
                                    <input type="range" id="mid-q" min="0.1" max="10" value="1" step="0.1">
                                    <span id="mid-q-value" class="gain-value">1.0</span>
                                </div>
                            </div>
                            <!-- High Band -->
                            <div class="eq-band">
                                <h5 data-i18n-key="eqHighLabel">High Band</h5>
                                 <div class="eq-slider">
                                    <label for="high-filter-type" data-i18n-key="eqTypeLabel">Type</label>
                                    <select id="high-filter-type">
                                        <option value="peaking" selected>Bell (Peaking)</option>
                                        <option value="lowshelf">Low Shelf</option>
                                        <option value="highshelf">High Shelf</option>
                                        <option value="lowpass">Low Pass</option>
                                        <option value="highpass">High Pass</option>
                                        <option value="bandpass">Bandpass</option>
                                        <option value="notch">Notch</option>
                                    </select>
                                </div>
                                <div class="eq-slider">
                                    <label for="high-gain" data-i18n-key="eqGainLabel">Gain</label>
                                    <input type="range" id="high-gain" class="eq-gain-slider" min="-12" max="12" value="0" step="1">
                                    <span id="high-gain-value" class="gain-value">0 dB</span>
                                </div>
                                <div class="eq-slider">
                                    <label for="high-freq" data-i18n-key="eqFreqLabel">Frequency</label>
                                    <input type="range" id="high-freq" min="2000" max="20000" value="10000" step="100">
                                    <span id="high-freq-value" class="gain-value">10.0 kHz</span>
                                </div>
                                <div class="eq-slider" id="high-q-container">
                                    <label for="high-q" data-i18n-key="eqQLabel">Q Factor</label>
                                    <input type="range" id="high-q" min="0.1" max="10" value="1" step="0.1">
                                    <span id="high-q-value" class="gain-value">1.0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <details class="multiband-compressor-section">
                    <summary>
                        <h4 class="visualizer-subtitle" data-i18n-key="compressorTitle">Multiband Compressor</h4>
                    </summary>
                    <div class="compressor-controls-container">
                        <div class="compressor-global-controls">
                            <div class="compressor-global-top-row">
                                <div class="checkbox-group">
                                    <input type="checkbox" id="compressor-enable">
                                    <label for="compressor-enable" data-i18n-key="compressorEnable">Enable</label>
                                </div>
                                <button id="compressor-reset-button" class="reset-button" data-i18n-key="resetButton">Reset</button>
                            </div>
                            <div class="crossover-controls">
                                <div class="eq-slider">
                                    <label for="low-mid-crossover" data-i18n-key="compressorLowMidCrossover">Low/Mid Crossover</label>
                                    <input type="range" id="low-mid-crossover" min="50" max="1000" value="250" step="1">
                                    <span id="low-mid-crossover-value" class="gain-value">250 Hz</span>
                                </div>
                                <div class="eq-slider">
                                    <label for="mid-high-crossover" data-i18n-key="compressorMidHighCrossover">Mid/High Crossover</label>
                                    <input type="range" id="mid-high-crossover" min="1000" max="10000" value="4000" step="10">
                                    <span id="mid-high-crossover-value" class="gain-value">4.0 kHz</span>
                                </div>
                            </div>
                        </div>
                        <div class="compressor-bands">
                            <!-- Low Band -->
                            <div class="compressor-band">
                                <h5><span data-i18n-key="eqLowLabel">Low Band</span></h5>
                                <div class="gr-meter-container">
                                    <div id="low-gr-meter" class="gr-meter-bar"></div>
                                </div>
                                <div class="eq-slider">
                                    <label for="low-comp-threshold" data-i18n-key="compressorThreshold">Threshold</label>
                                    <input type="range" id="low-comp-threshold" min="-100" max="0" value="-24" step="1">
                                    <span id="low-comp-threshold-value" class="gain-value">-24 dB</span>
                                </div>
                                <div class="eq-slider">
                                    <label for="low-comp-ratio" data-i18n-key="compressorRatio">Ratio</label>
                                    <input type="range" id="low-comp-ratio" min="1" max="20" value="4" step="0.1">
                                    <span id="low-comp-ratio-value" class="gain-value">4.0:1</span>
                                </div>
                                <div class="eq-slider">
                                    <label for="low-comp-attack" data-i18n-key="compressorAttack">Attack</label>
                                    <input type="range" id="low-comp-attack" min="0" max="1" value="0.01" step="0.001">
                                    <span id="low-comp-attack-value" class="gain-value">10 ms</span>
                                </div>
                                <div class="eq-slider">
                                    <label for="low-comp-release" data-i18n-key="compressorRelease">Release</label>
                                    <input type="range" id="low-comp-release" min="0.01" max="1" value="0.3" step="0.01">
                                    <span id="low-comp-release-value" class="gain-value">300 ms</span>
                                </div>
                                <div class="eq-slider">
                                    <label for="low-comp-makeup" data-i18n-key="compressorMakeup">Makeup Gain</label>
                                    <input type="range" id="low-comp-makeup" min="0" max="24" value="0" step="1">
                                    <span id="low-comp-makeup-value" class="gain-value">0 dB</span>
                                </div>
                            </div>
                            <!-- Mid Band -->
                            <div class="compressor-band">
                                <h5><span data-i18n-key="eqMidLabel">Mid Band</span></h5>
                                <div class="gr-meter-container">
                                    <div id="mid-gr-meter" class="gr-meter-bar"></div>
                                </div>
                                <div class="eq-slider">
                                    <label for="mid-comp-threshold" data-i18n-key="compressorThreshold">Threshold</label>
                                    <input type="range" id="mid-comp-threshold" min="-100" max="0" value="-24" step="1">
                                    <span id="mid-comp-threshold-value" class="gain-value">-24 dB</span>
                                </div>
                                <div class="eq-slider">
                                    <label for="mid-comp-ratio" data-i18n-key="compressorRatio">Ratio</label>
                                    <input type="range" id="mid-comp-ratio" min="1" max="20" value="3" step="0.1">
                                    <span id="mid-comp-ratio-value" class="gain-value">3.0:1</span>
                                </div>
                                <div class="eq-slider">
                                    <label for="mid-comp-attack" data-i18n-key="compressorAttack">Attack</label>
                                    <input type="range" id="mid-comp-attack" min="0" max="1" value="0.005" step="0.001">
                                    <span id="mid-comp-attack-value" class="gain-value">5 ms</span>
                                </div>
                                <div class="eq-slider">
                                    <label for="mid-comp-release" data-i18n-key="compressorRelease">Release</label>
                                    <input type="range" id="mid-comp-release" min="0.01" max="1" value="0.2" step="0.01">
                                    <span id="mid-comp-release-value" class="gain-value">200 ms</span>
                                </div>
                                <div class="eq-slider">
                                    <label for="mid-comp-makeup" data-i18n-key="compressorMakeup">Makeup Gain</label>
                                    <input type="range" id="mid-comp-makeup" min="0" max="24" value="0" step="1">
                                    <span id="mid-comp-makeup-value" class="gain-value">0 dB</span>
                                </div>
                            </div>
                            <!-- High Band -->
                            <div class="compressor-band">
                                <h5><span data-i18n-key="eqHighLabel">High Band</span></h5>
                                <div class="gr-meter-container">
                                    <div id="high-gr-meter" class="gr-meter-bar"></div>
                                </div>
                                <div class="eq-slider">
                                    <label for="high-comp-threshold" data-i18n-key="compressorThreshold">Threshold</label>
                                    <input type="range" id="high-comp-threshold" min="-100" max="0" value="-24" step="1">
                                    <span id="high-comp-threshold-value" class="gain-value">-24 dB</span>
                                </div>
                                <div class="eq-slider">
                                    <label for="high-comp-ratio" data-i18n-key="compressorRatio">Ratio</label>
                                    <input type="range" id="high-comp-ratio" min="1" max="20" value="5" step="0.1">
                                    <span id="high-comp-ratio-value" class="gain-value">5.0:1</span>
                                </div>
                                <div class="eq-slider">
                                    <label for="high-comp-attack" data-i18n-key="compressorAttack">Attack</label>
                                    <input type="range" id="high-comp-attack" min="0" max="1" value="0.001" step="0.001">
                                    <span id="high-comp-attack-value" class="gain-value">1 ms</span>
                                </div>
                                <div class="eq-slider">
                                    <label for="high-comp-release" data-i18n-key="compressorRelease">Release</label>
                                    <input type="range" id="high-comp-release" min="0.01" max="1" value="0.1" step="0.01">
                                    <span id="high-comp-release-value" class="gain-value">100 ms</span>
                                </div>
                                <div class="eq-slider">
                                    <label for="high-comp-makeup" data-i18n-key="compressorMakeup">Makeup Gain</label>
                                    <input type="range" id="high-comp-makeup" min="0" max="24" value="0" step="1">
                                    <span id="high-comp-makeup-value" class="gain-value">0 dB</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </details>
            </div>

            <fieldset class="analysis-options">
                <legend data-i18n-key="processingOptionsTitle">Processing Options</legend>
                <div class="checkbox-group disabled-option">
                    <input type="checkbox" id="option-truncate" name="processing-options" value="truncate" checked disabled>
                    <label for="option-truncate" data-i18n-key="optionTruncate">Truncate audio to first 45s</label>
                </div>
            </fieldset>

            <fieldset class="analysis-options">
                <legend data-i18n-key="analysisOptionsTitle">Analysis Options</legend>
                <div class="checkbox-group">
                    <input type="checkbox" id="option-metadata" name="analysis-options" value="metadata" checked>
                    <label for="option-metadata" data-i18n-key="optionMetadata">Song Key, BPM, & Genre ID</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="option-spectral" name="analysis-options" value="spectral" checked>
                    <label for="option-spectral" data-i18n-key="optionSpectral">Spectral Balance & EQ</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="option-dynamics-stereo" name="analysis-options" value="dynamics-stereo" checked>
                    <label for="option-dynamics-stereo" data-i18n-key="optionDynamicsStereo">Dynamics & Stereo Image</label>
                </div>
                 <div class="checkbox-group">
                    <input type="checkbox" id="option-effects" name="analysis-options" value="effects">
                    <label for="option-effects" data-i18n-key="optionEffects">Reverb & Delay Analysis</label>
                </div>
                <div class="checkbox-group disabled-option">
                    <input type="checkbox" id="option-ai-check" name="analysis-options" value="ai-check" disabled>
                    <label for="option-ai-check" data-i18n-key="optionAiCheck">AI Generation Check</label>
                </div>
            </fieldset>

            <button id="submit-button" disabled data-i18n-key="submitButton">Analyze Audio</button>

        </section>

        <section id="result-container" class="output-panel" aria-live="polite">
          <div class="output-header">
             <div class="bmc-container">
                <script type="text/javascript" src="https://cdnjs.buymeacoffee.com/1.0.0/button.prod.min.js" data-name="bmc-button" data-slug="stancsz" data-color="#FFDD00" data-emoji="☕"  data-font="Cookie" data-text="Buy me a coffee" data-outline-color="#000000" data-font-color="#000000" data-coffee-color="#ffffff" ></script>
             </div>
             <button id="download-button" hidden data-i18n-key="downloadButton">Download Report</button>
          </div>
          <div id="loader" class="loader" hidden></div>
          <div id="result-text" data-i18n-key="initialResultText">Your audio analysis will appear here.</div>
        </section>
    </main>
    <script type="module" src="index.tsx"></script>
  </body>
</html>